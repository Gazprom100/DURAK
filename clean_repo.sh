#!/bin/bash

# Скрипт для очистки истории Git от больших файлов (node_modules)

echo "⚠️ Предупреждение: Этот скрипт изменит историю Git! ⚠️"
echo "Убедитесь, что у вас есть резервная копия, если это важно."
read -p "Продолжить? (y/n) " -n 1 -r
echo
if [[ ! $REPLY =~ ^[Yy]$ ]]
then
    exit 1
fi

# Создаем новую ветку без истории
echo "Создание новой ветки без истории..."
git checkout --orphan temp_branch

# Добавляем все файлы (кроме node_modules и других исключенных)
echo "Добавление файлов..."
git add .

# Создаем первоначальный коммит
echo "Создание первоначального коммита..."
git commit -m "Initial commit - clean history"

# Удаляем старую ветку
echo "Удаление старой ветки main..."
git branch -D main

# Переименовываем новую ветку
echo "Переименование новой ветки в main..."
git branch -m main

# Принудительно обновляем удаленный репозиторий (если нужно)
echo "Для обновления удаленного репозитория выполните:"
echo "git push -f origin main"

echo "Запуск очистки и сжатия репозитория..."
git gc --aggressive --prune=now

echo "Готово! Размер .git директории должен быть значительно меньше."
echo "Проверьте с помощью: du -sh .git" 